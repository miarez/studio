<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />




  </head>
  <body>
    <script >
        const cs = console.log


        class App {
            constructor() {
                this.canvases = [];
                this.currentCanvasIndex = 0;
            }

            add_shape(
            ){
                let shape = new Rect(30, 30, 10, 10)
                this.canvases[this.currentCanvasIndex].add_shape(shape)
                this.canvases[this.currentCanvasIndex].show()
            }

            addCanvas(canvas) {
                this.canvases.push(canvas);
            }

            removeCanvas(canvasId) {
                const index = this.canvases.findIndex(c => c.id === canvasId);
                if (index !== -1) {
                    this.canvases[index].stop(); // Stop the loop before removing
                    this.canvases.splice(index, 1);
                }
            }

            showCanvas(index) {
                this.canvases[this.currentCanvasIndex].hide(); // Hide the current canvas
                this.canvases[index].show(); // Show the new canvas
                this.currentCanvasIndex = index; // Update the current canvas index
            }
        }

        class Shape {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.dragging = false;
                this.dragOffsetX = 0;
                this.dragOffsetY = 0;
            }

            // Method to check if a point is within the shape
            contains(px, py) {
                // This method should be overridden by subclasses
            }

            // Start dragging the shape
            onMousePressed(s, mouseX, mouseY) {
                if (this.contains(mouseX, mouseY)) {
                    this.dragging = true;
                    this.dragOffsetX = this.x - mouseX;
                    this.dragOffsetY = this.y - mouseY;
                }
            }

            // Stop dragging the shape
            onMouseReleased() {
                this.dragging = false;
            }

            // Update the shape's position if dragging
            onMouseDragged(s, mouseX, mouseY) {
                if (this.dragging) {
                    this.x = mouseX + this.dragOffsetX;
                    this.y = mouseY + this.dragOffsetY;
                }
                this.show(s); // Redraw the shape at new position
            }
        }

        class Rect extends Shape {
            constructor(x, y, width, height) {
                super(x, y);
                this.width = width;
                this.height = height;
            }

            contains(px, py) {
                return px >= this.x && px <= this.x + this.width && py >= this.y && py <= this.y + this.height;
            }

            show(s) {
                s.fill(10, 200, 10);
                s.rect(this.x, this.y, this.width, this.height);
            }
        }

        class Circle extends Shape {
            constructor(x, y, radius) {
                super(x, y);
                this.radius = radius;
            }

            contains(px, py) {
                let d = Math.sqrt((px - this.x) ** 2 + (py - this.y) ** 2);
                return d <= this.radius;
            }

            show(s) {
                s.fill(10, 200, 10);
                s.ellipse(this.x, this.y, this.radius * 2);
            }
        }

        class Canvas {
            constructor(id, w, h, fill) {
                this.element;
                this.shapes = [];
                this.id = id;
                this.w = w;
                this.h = h;
                this.fill = fill;

                this.sketch = new p5((s) => {
                    s.setup = () => {
                        s.createCanvas(this.w, this.h).parent(id);
                        this.element = s.canvas;
                    };
                    s.render = () => {
                        s.background(this.fill);
                        this.shapes.forEach(shape => {
                            shape.show(s);
                        });
                    };
                    s.mousePressed = () => {
                        this.handleMousePressed(s);
                    };
                    s.mouseReleased = () => {
                        this.handleMouseReleased();
                    };
                    s.mouseDragged = () => {
                        this.handleMouseDragged(s);
                    };
                }, id);
            }

            add_shape(shape) {
                this.shapes.push(shape);
                return this;
            }

            show() {
                this.element.style.display = 'block';
                this.sketch.render();
            }

            hide() {
                this.element.style.display = 'none';
            }

            handleMousePressed(s) {
                this.shapes.forEach(shape => shape.onMousePressed(s, s.mouseX, s.mouseY));
                this.sketch.render()
            }

            handleMouseReleased() {
                this.shapes.forEach(shape => shape.onMouseReleased());
                this.sketch.render()
            }

            handleMouseDragged(s) {
                this.shapes.forEach(shape => shape.onMouseDragged(s, s.mouseX, s.mouseY));
                this.sketch.render()
            }
        }


        // Set up the app
        const app = new App();

        app.addCanvas(new Canvas('canvas1', 100, 100, 100)
            .add_shape(new Rect(10, 10, 20, 20))
        );
        app.addCanvas(new Canvas('canvas2', 100, 100, 100)
            .add_shape(new Circle(20, 20, 30))
        );

        // Add buttons for switching canvases
        document.body.innerHTML += `<button onclick="app.showCanvas(0)">Show Canvas 1</button>`;
        document.body.innerHTML += `<button onclick="app.showCanvas(1)">Show Canvas 2</button>`;

        document.body.innerHTML += `<button onclick="app.add_shape()">Add Rect</button>`;

        // Add divs for the canvases
        document.body.innerHTML += `<div id="canvas1"></div><div id="canvas2" ></div>`;


    </script>
  </body>
</html>
